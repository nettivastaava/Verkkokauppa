(this["webpackJsonpverkkokauppa-frontend"]=this["webpackJsonpverkkokauppa-frontend"]||[]).push([[0],{104:function(e,t,n){},105:function(e,t,n){"use strict";n.r(t);var r,c,a,s,i,o,u,j,d,l,b,O,h,p=n(65),x=n(0),m=n(81),f=n.n(m),g=n(7),v=n(6),y=n(23),S=Object(v.gql)(r||(r=Object(y.a)(["\n  query allProductsByCategory($category: String){\n    allProducts(category: $category) {\n      name\n      price\n      quantity\n      id\n      categories\n      description\n      comments {\n        user\n        product\n        content\n      }\n      units_sold\n    }\n  }\n  "]))),C=Object(v.gql)(c||(c=Object(y.a)(["\n  mutation login($username: String!, $password: String!) {\n    login(username: $username, password: $password) {\n      value\n    }\n  }\n"]))),w=Object(v.gql)(a||(a=Object(y.a)(["\nquery {\n  allCategories\n}\n"]))),q=Object(v.gql)(s||(s=Object(y.a)(["\n  query {\n    me {\n      username\n      id\n      cart {\n        productName\n        amount\n        price\n      }\n    }\n  }\n  "]))),$=Object(v.gql)(i||(i=Object(y.a)(["\n  mutation createUser($username: String!, $password: String!, $passwordConf: String!) {\n    createUser(username: $username, password: $password, passwordConf: $passwordConf) {\n      username\n    }\n  }\n"]))),k=Object(v.gql)(o||(o=Object(y.a)(["\n  mutation decreaseQuantity($name: String!, $quantity: Int!) {\n    decreaseQuantity(name: $name, quantity: $quantity) {\n      name\n      quantity\n    }\n  }\n"]))),E=(Object(v.gql)(u||(u=Object(y.a)(["\n  query findProduct($name: String!) {\n    findProduct(name: $name) {\n      name\n      price\n      quantity\n    }\n  }\n"]))),Object(v.gql)(j||(j=Object(y.a)(["\n  mutation addComment($user: String!, $product: String!, $content: String!) {\n    addComment(user: $user, product: $product, content: $content) {\n      user\n      product\n      content\n    }\n  }\n"])))),N=Object(v.gql)(d||(d=Object(y.a)(["\n  query allCommentsByProduct($product: String){\n    allComments(product: $product) {\n      user\n      product\n      content\n    }\n  }\n"]))),Q=Object(v.gql)(l||(l=Object(y.a)(["\n  mutation addToCart($productName: String!, $price: Float!) {\n    addToCart(productName: $productName, price: $price) {\n      username\n      cart {\n        productName\n        price\n        amount\n      }\n    }\n  }\n"]))),T=Object(v.gql)(b||(b=Object(y.a)(["\n  mutation removeFromCart($productName: String!) {\n    removeFromCart(productName: $productName) {\n      username\n      cart {\n        productName\n        price\n        amount\n      }\n    }\n  }\n"]))),I=(Object(v.gql)(O||(O=Object(y.a)(["\n  query {\n    totalPrice\n  }\n"]))),Object(v.gql)(h||(h=Object(y.a)(["\n  mutation {\n    checkout {\n      username\n      cart {\n        productName\n        price\n        amount\n      }\n    }\n  }\n"])))),L=n(22),M=n.n(L),P=n(32),B=n(2),R=(n(3),n(108)),A=n(106),Y=n(107),F=function(e){var t=e.shownProduct,n=e.addToCart,r=e.setError,c=Object(x.useState)(""),a=Object(g.a)(c,2),s=a[0],i=a[1],o=Object(x.useState)([]),u=Object(g.a)(o,2),j=u[0],d=u[1],l=Object(v.useQuery)(q),b=Object(v.useLazyQuery)(N),O=Object(g.a)(b,2),h=(O[0],O[1],Object(x.useState)(null)),p=Object(g.a)(h,2),m=p[0],f=p[1],y=Object(v.useMutation)(E,{refetchQueries:[{query:S}],onError:function(e){r(e)}}),C=Object(g.a)(y,2),w=C[0];C[1];if(Object(x.useEffect)((function(){if(t&&localStorage.getItem("shop-user-token")&&document.getElementById("buy-button")){d(t.comments);var e=document.getElementById("buy-button");t.quantity<1?e.disabled=!0:e.disabled=!1}})),Object(x.useEffect)((function(){l.data&&l.data.me&&f(l.data.me.id)}),[l]),l.loading)return Object(B.jsx)("div",{children:"loading..."});if(!t)return null;if(!localStorage.getItem("shop-user-token"))return Object(B.jsxs)("div",{children:[Object(B.jsx)("h2",{children:t.name}),Object(B.jsx)("table",{children:Object(B.jsxs)("tbody",{children:[Object(B.jsxs)("tr",{children:[Object(B.jsx)("th",{}),Object(B.jsx)("th",{children:"price"}),Object(B.jsx)("th",{children:"description"}),Object(B.jsx)("th",{children:"quantity"})]}),Object(B.jsxs)("tr",{children:[Object(B.jsx)("td",{children:t.name}),Object(B.jsxs)("td",{children:[t.price,"$"]}),Object(B.jsx)("td",{children:t.description}),Object(B.jsx)("td",{children:t.quantity})]})]})}),"Log in to see the reviews for this product"]});var $=Object(B.jsx)(R.a,{id:"buy-button",onClick:function(){return n(t)},children:"add to cart"}),k=function(){var e=Object(P.a)(M.a.mark((function e(n){var r;return M.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n.preventDefault(),r=t.id,w({variables:{user:m,product:r,content:s}}),i("");case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(B.jsxs)("div",{children:[Object(B.jsx)("h2",{children:t.name}),Object(B.jsx)(A.a,{striped:!0,children:Object(B.jsxs)("tbody",{children:[Object(B.jsxs)("tr",{children:[Object(B.jsx)("th",{}),Object(B.jsx)("th",{children:"price"}),Object(B.jsx)("th",{children:"description"}),Object(B.jsx)("th",{children:"quantity"}),Object(B.jsx)("th",{})]}),Object(B.jsxs)("tr",{children:[Object(B.jsx)("td",{children:t.name}),Object(B.jsxs)("td",{children:[t.price,"$"]}),Object(B.jsx)("td",{children:t.description}),Object(B.jsx)("td",{children:t.quantity}),Object(B.jsx)("td",{children:$})]})]})}),j.map((function(e){return Object(B.jsx)("div",{children:Object(B.jsx)("div",{children:e.content})},e.id)})),Object(B.jsxs)(Y.a,{onSubmit:k,children:[Object(B.jsx)("textarea",{value:s,onChange:function(e){var t=e.target;return i(t.value)},className:"text",cols:"50",rows:"5"}),Object(B.jsx)("div",{children:Object(B.jsx)(R.a,{type:"submit",children:"Review this product!"})})]})]})},z=n(15),D=function(e){var t=e.myCart,n=e.setMyCart,r=e.addToCart,c=e.setError,a=Object(v.useQuery)(w),s=Object(v.useLazyQuery)(S),i=Object(g.a)(s,2),o=i[0],u=i[1],j=Object(x.useState)(""),d=Object(g.a)(j,2),l=(d[0],d[1]),b=Object(x.useState)([]),O=Object(g.a)(b,2),h=O[0],p=O[1],m=Object(x.useState)([]),f=Object(g.a)(m,2),y=f[0],C=f[1];Object(x.useEffect)((function(){a.data&&(p(a.data.allCategories),o())}),[a,o]),Object(x.useEffect)((function(){u.data&&C(u.data.allProducts)}),[u]);var q=Object(z.g)("/products/:id"),$=q?y.find((function(e){return e.id===q.params.id})):null;if(a.loading||u.loading)return Object(B.jsx)("div",{children:"loading..."});var k=function(e){o({variables:{category:e}}),l(e||"")},E={buttonStyle:{marginTop:"3px",marginBottom:"3px",marginRight:"3px",marginLeft:"3px"}};return Object(B.jsxs)("div",{children:[Object(B.jsx)(z.c,{children:Object(B.jsx)(z.a,{path:"/products/:id",children:Object(B.jsx)(F,{shownProduct:$,myCart:t,setMyCart:n,addToCart:r,setError:c})})}),Object(B.jsx)("h2",{children:"Search products"}),Object(B.jsxs)("div",{children:[h.map((function(e){return Object(B.jsx)(R.a,{style:E.buttonStyle,onClick:function(){return k(e)},children:e})})),Object(B.jsx)(R.a,{style:E.buttonStyle,onClick:function(){return k("")},children:"trending"})]}),Object(B.jsx)(A.a,{striped:!0,children:Object(B.jsxs)("tbody",{children:[Object(B.jsxs)("tr",{children:[Object(B.jsx)("th",{}),Object(B.jsx)("th",{children:"price"}),Object(B.jsx)("th",{children:"quantity"})]}),y.map((function(e){return Object(B.jsxs)("tr",{children:[Object(B.jsx)("td",{children:Object(B.jsx)("a",{href:"/products/".concat(e.id),children:e.name})}),Object(B.jsxs)("td",{children:[e.price,"$"]}),Object(B.jsx)("td",{children:e.quantity})]},e.name)}))]})})]})},G=function(e){var t=e.setToken,n=e.setNotification,r=Object(x.useState)(""),c=Object(g.a)(r,2),a=c[0],s=c[1],i=Object(x.useState)(""),o=Object(g.a)(i,2),u=o[0],j=o[1],d=Object(z.f)(),l=Object(v.useMutation)(C,{refetchQueries:[{query:q}],onError:function(e){n(e.graphQLErrors[0].message),setTimeout((function(){n("")}),1e4)}}),b=Object(g.a)(l,2),O=b[0],h=b[1];Object(x.useEffect)((function(){if(h.data){var e=h.data.login.value;t(e),localStorage.setItem("shop-user-token",e),localStorage.setItem("username",a),d.push("/"),window.location.reload()}}),[h.data]);var p=function(){var e=Object(P.a)(M.a.mark((function e(t){return M.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.preventDefault(),O({variables:{username:a,password:u}});case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(B.jsxs)("div",{children:[Object(B.jsx)("h2",{children:"Login"}),Object(B.jsx)(Y.a,{onSubmit:p,children:Object(B.jsxs)(Y.a.Group,{children:[Object(B.jsx)(Y.a.Label,{children:"username:"}),Object(B.jsx)(Y.a.Control,{type:"text",value:a,onChange:function(e){var t=e.target;return s(t.value)}}),Object(B.jsx)(Y.a.Label,{children:"password:"}),Object(B.jsx)(Y.a.Control,{type:"password",value:u,onChange:function(e){var t=e.target;return j(t.value)}}),Object(B.jsx)(R.a,{type:"submit",children:"login"})]})}),Object(B.jsxs)("p",{children:["New user? Register ",Object(B.jsx)("a",{href:"/register",children:"here"})]})]})},J=function(e){var t=e.setNotification,n=Object(x.useState)(""),r=Object(g.a)(n,2),c=r[0],a=r[1],s=Object(x.useState)(""),i=Object(g.a)(s,2),o=i[0],u=i[1],j=Object(x.useState)(""),d=Object(g.a)(j,2),l=d[0],b=d[1],O=Object(z.f)(),h=Object(v.useMutation)($,{onError:function(e){t(e.graphQLErrors[0].message),setTimeout((function(){t("")}),1e4)}}),p=Object(g.a)(h,2),m=p[0],f=p[1];Object(x.useEffect)((function(){f.data&&(a(""),u(""),b(""),O.push("/login"))}),[f.data]);var y=function(){var e=Object(P.a)(M.a.mark((function e(t){return M.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.preventDefault(),m({variables:{username:c,password:o,passwordConf:l}});case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(B.jsxs)("div",{children:[Object(B.jsx)("h2",{children:"Create a new account"}),Object(B.jsx)(Y.a,{onSubmit:y,children:Object(B.jsxs)(Y.a.Group,{children:[Object(B.jsx)(Y.a.Label,{children:"username:"}),Object(B.jsx)(Y.a.Control,{type:"text",value:c,onChange:function(e){var t=e.target;return a(t.value)}}),Object(B.jsx)(Y.a.Label,{children:"password:"}),Object(B.jsx)(Y.a.Control,{type:"password",value:o,onChange:function(e){var t=e.target;return u(t.value)}}),Object(B.jsx)(Y.a.Label,{children:"password confirmation:"}),Object(B.jsx)(Y.a.Control,{type:"password",value:l,onChange:function(e){var t=e.target;return b(t.value)}}),Object(B.jsx)(R.a,{type:"submit",children:"register"})]})})]})},U=function(e){var t=e.user,n=e.setNotification,r=e.setError,c=Object(x.useState)([]),a=Object(g.a)(c,2),s=a[0],i=a[1],o=Object(v.useMutation)(T,{refetchQueries:[{query:q}],onError:function(e){r(e)}}),u=Object(g.a)(o,2),j=u[0],d=(u[1],Object(v.useMutation)(I,{refetchQueries:[{query:q}],onError:function(e){r(e)}})),l=Object(g.a)(d,2),b=l[0];l[1];if(Object(x.useEffect)((function(){i(t.cart)})),s<1)return Object(B.jsxs)("div",{children:[Object(B.jsx)("h2",{children:"Your shopping cart"}),"Your shopping cart is currently empty."]});var O=0;s.map((function(e){return O+=e.price*e.amount})),O=O.toFixed(2);var h=function(){var e=Object(P.a)(M.a.mark((function e(){var t;return M.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(t=0;t<s.length;t++)b(),n("Your purchase was successful"),setTimeout((function(){n("")}),5e3);case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(B.jsxs)("div",{children:[Object(B.jsx)("h2",{children:"Your shopping cart"}),Object(B.jsx)(A.a,{striped:!0,children:Object(B.jsxs)("tbody",{children:[Object(B.jsxs)("tr",{children:[Object(B.jsx)("th",{}),Object(B.jsx)("th",{children:"price per unit"}),Object(B.jsx)("th",{children:"amount"}),Object(B.jsx)("th",{})]}),s.map((function(e){return Object(B.jsxs)("tr",{children:[Object(B.jsx)("td",{children:e.productName}),Object(B.jsxs)("td",{children:[e.price,"$"]}),Object(B.jsx)("td",{children:e.amount}),Object(B.jsx)("td",{children:Object(B.jsx)("button",{onClick:function(){return function(e){var t=e.productName;j({variables:{productName:t}}),n("Removed ".concat(t," from cart")),setTimeout((function(){n("")}),5e3),O=-e.price}(e)},children:"remove"})})]},e.product)})),Object(B.jsxs)("tr",{children:[Object(B.jsx)("th",{children:"grand total:"}),Object(B.jsxs)("th",{children:[O,"$"]})]})]})}),Object(B.jsx)("button",{onClick:function(){return h()},children:"checkout"})]})},W=function(e){var t=e.message;return console.log(t),""===t?null:t.match("^Added")||t.match("^Your purchase was successful")?Object(B.jsx)("div",{className:"addProd",children:t}):(t.match("^Removed")||t.match("^Make")||t.match("^Invalid"),Object(B.jsx)("div",{className:"removeProd",children:t}))},H=function(e){var t=e.logout,n={paddingRight:5};return localStorage.getItem("shop-user-token")?Object(B.jsxs)("div",{children:[Object(B.jsx)("a",{href:"/products",style:n,children:"products"}),Object(B.jsx)("a",{href:"/shopping-cart",style:n,children:"shopping cart"}),Object(B.jsx)("a",{href:"/",onClick:t,children:"logout"})]}):Object(B.jsxs)("div",{children:[Object(B.jsx)("a",{href:"/products",style:n,children:"products"}),Object(B.jsx)("a",{href:"/login",style:n,children:"login"})]})},_=function(){var e=Object(x.useState)(""),t=Object(g.a)(e,2),n=(t[0],t[1]),r=Object(x.useState)(""),c=Object(g.a)(r,2),a=c[0],s=c[1],i=Object(v.useQuery)(q),o=Object(v.useMutation)(k,{refetchQueries:[{query:S}],onError:function(e){w(e)}}),u=Object(g.a)(o,2),j=(u[0],u[1],Object(v.useMutation)(Q,{refetchQueries:[{query:S}],onError:function(e){w(e)}})),d=Object(g.a)(j,2),l=d[0],b=(d[1],Object(x.useState)(null)),O=Object(g.a)(b,2),h=(O[0],O[1]),p=Object(v.useApolloClient)(),m=Object(x.useState)([]),f=Object(g.a)(m,2),y=f[0],C=f[1],w=function(e){n(e),setTimeout((function(){n("")}),1e4)};if(i.loading)return Object(B.jsx)("div",{children:"loading..."});return localStorage.getItem("shop-user-token")?Object(B.jsxs)("div",{children:[Object(B.jsx)("h1",{children:"Web Store"}),Object(B.jsx)(W,{message:a}),Object(B.jsx)(H,{logout:function(){h(null),localStorage.clear(),p.resetStore()}}),Object(B.jsxs)(z.c,{children:[Object(B.jsx)(z.a,{path:"/shopping-cart",children:Object(B.jsx)(U,{user:i.data.me,setNotification:s,setError:w})}),Object(B.jsx)(z.a,{path:"/products",children:Object(B.jsx)(D,{myCart:y,setMyCart:C,addToCart:function(e){var t=e.name,n=e.price;console.log("prod ",t),l({variables:{productName:t,price:n}}),s("Added ".concat(t," to cart")),setTimeout((function(){s("")}),5e3)},setError:w})})]})]}):Object(B.jsxs)("div",{className:"container",children:[Object(B.jsx)("h1",{children:"Web Store"}),Object(B.jsx)(W,{message:a}),Object(B.jsx)(H,{}),Object(B.jsxs)(z.c,{children:[Object(B.jsx)(z.a,{path:"/login",children:Object(B.jsx)(G,{setToken:h,setNotification:s})}),Object(B.jsx)(z.a,{path:"/register",children:Object(B.jsx)(J,{setNotification:s})}),Object(B.jsx)(z.a,{path:"/products",children:Object(B.jsx)(D,{})})]})]})},K=n(84),V=(n(104),n(44)),X=Object(K.a)((function(e,t){var n=t.headers,r=localStorage.getItem("shop-user-token");return{headers:Object(p.a)(Object(p.a)({},n),{},{authorization:r?"bearer ".concat(r):null})}})),Z=new v.HttpLink({uri:"/graphql"}),ee=new v.ApolloClient({cache:new v.InMemoryCache,link:X.concat(Z)});f.a.render(Object(B.jsx)(v.ApolloProvider,{client:ee,children:Object(B.jsx)(V.a,{children:Object(B.jsx)(_,{})})}),document.getElementById("root"))}},[[105,1,2]]]);
//# sourceMappingURL=main.5d9c9786.chunk.js.map